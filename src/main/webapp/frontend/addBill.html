<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>记一笔</title>
    <link rel="stylesheet" href="static/css/bootstrap.min.css"/>

    <script src="static/script/jquery.min.js"></script>
    <script src="static/script/bootstrap.min.js"></script>

    <link rel="stylesheet" href="static/css/colorjson.css"/>
    <script type="text/javascript" src="static/script/colorjson.js"></script>
    <script type="text/javascript" src="static/script/myAjax.js"></script>
    <script type="text/javascript" src="static/script/sys.js"></script>


    <script>
        var url = window.location.search;
        //url=?userId=10086&id=2&accountName=招商银行
        console.log("url=" + url);

        var userId = getFormValue(url, 'userId');

        $(document).ready(function () {

            queryAccountNameByUserId();

        })

        //查账户
        function queryAccountNameByUserId() {

            //动态下拉窗口重置
            $.ajax({
                url: "/account/queryAccountName?userId=" + userId, //路径, 比如/user/create
                type: "post",
                data: null,
                success: function (data, status) {
                    //成功
                    console.log("call success:" + JSON.stringify(data));
                    //callback(data, status);

                    var arr = data.data;

                    for (var index in arr) {
                        //console.log(index + ", " + JSON.stringify(arr[index]));

                        var accountId = arr[index].id;
                        var accountName = arr[index].accountName;
                        var remark = arr[index].remark;

                        if (index == 0) {
                            //获取第一个账户
                            console.log("获取第一个账户:" + accountName);
                            selected(userId, accountId, accountName, remark);
                        }


                        var str = "<li><a name='accountName' href='#' onclick='selected(\"" + userId + "\",\""
                            + accountId + "\",\"" + accountName + "\",\"" + remark + "\")'>" + accountName + remark + "</a></li>";

                        document.getElementById("accountNames").innerHTML += str;
                        document.getElementById("accountNames2").innerHTML += str;

                        console.log("str=" + str);
                    }

                },

                error: function (data, status) {
                    //失败
                    console.error("call fail:" + data);
                    //callback(data, status);
                }
            });
        }

        //表示选中操作
        function selected(userId, accountId, accountName, remark) {

            document.getElementById("accountName").innerText = accountName + remark;
            document.getElementById("accountId").value = accountId;
            document.getElementById("userId").value = userId;

            document.getElementById("accountName2").innerText = accountName + remark;
            document.getElementById("accountId2").value = accountId;
            document.getElementById("userId2").value = userId;
        }
    </script>
</head>
<body>

<!-- ol:organized list
ul:unorganized list
-->
<ol class="breadcrumb">
    <li><a href="/">支付模拟器</a></li>
    <li><a href="/">Home</a></li>
    <li class="active">主页</li>
</ol>


<div class="container">
    <ul id="myTab" class="nav nav-pills nav-justified">
        <li class="active">
            <a href="#Income" data-toggle="tab" style="font-size: 32px;">流入</a>
        </li>
        <li>
            <a href="#Expenditure" data-toggle="tab" style="font-size: 32px;">流出</a>
        </li>
        <li>
            <a href="#zhuanzhang" data-toggle="tab" style="font-size: 32px;">内部转账</a>
        </li>
    </ul>
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade in active" id="Income">

            <div class="container">

                <form id="myForm1" class="form-horizontal" role="form" action="/dailybill/create" method="post">
                    <div class="form-group col-sm-12">
                        <div class="col-sm-6">
                            <div class="col-sm-6">
                                <br>
                                <button type="button" class="btn btn-primary btn-lg btn-block"
                                        data-toggle="dropdown">

                                    <div class="row">
                                        <div class="text-left">
                                            <span id="accountName" name="accountName"></span>
                                        </div>
                                    </div>
                                </button>
                                <ul class="dropdown-menu" role="menu" id="accountNames">
                                </ul>
                            </div>
                        </div>

                        <div class="col-sm-4 text-right">
                            <br/><input type="text" style="font-size: 40px;" name="txAmount" value="0.00">
                        </div>
                    </div>

                    <div>
                        <div class="form-group">
                            <table class="table">
                                <tbody style="font-size: 30px;">
                                <tr>
                                    <td>薪资</td>
                                    <td>奖金</td>
                                    <td>借入</td>
                                    <td>收债</td>
                                    <td>利息</td>
                                </tr>
                                <tr>
                                    <td>退款</td>
                                    <td>投资</td>
                                    <td>报销</td>
                                    <td>收益</td>
                                    <td>其他</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-4">
                            选择日期
                            <input type="date" value="2019-02-25" name="txDate"/>
                        </div>

                        <div class="col-sm-6">
                            <input type="text" class="form-control" name="remark" value="备注"/>
                        </div>

                    </div>

                    <input type="hidden" id="accountId" name="accountId">
                    <input type="hidden" id="userId" name="userId">

                    <input type="hidden" name="txType" value="Income">


                    <div class="form-group">
                        <div class="col-sm-6">
                            <button type="submit" class="btn btn-info" onclick="submitByClick('myForm1')">提交
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="tab-pane fade" id="Expenditure">
            <div class="container">

                <form id="myForm2" class="form-horizontal" role="form" action="/dailybill/create" method="post">
                    <div class="form-group col-sm-12">
                        <div class="col-sm-6">
                            <div class="col-sm-6">
                                <br/>
                                <button type="button" class="btn btn-primary btn-lg btn-block"
                                        data-toggle="dropdown">

                                    <div class="row">
                                        <div class="text-left">
                                            <span id="accountName2" name="accountName"></span>
                                        </div>
                                    </div>
                                </button>
                                <ul class="dropdown-menu" role="menu" id="accountNames2">
                                </ul>
                            </div>
                        </div>

                        <div class="col-sm-4 text-right">
                            <br/><input type="text" style="font-size: 40px;" name="txAmount" value="0.00">
                        </div>
                    </div>

                    <div>
                        <div class="form-group">
                            <table class="table">
                                <tbody style="font-size: 30px;">
                                <tr>
                                    <td>餐饮</td>
                                    <td>零食</td>
                                    <td>购物</td>
                                    <td>住房</td>
                                    <td>交通</td>
                                </tr>
                                <tr>
                                    <td>娱乐</td>
                                    <td>文教</td>
                                    <td>汽车</td>
                                    <td>通讯</td>
                                    <td>育儿</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-4">
                            选择日期
                            <input type="date" value="2019-02-25" name="txDate"/>
                        </div>

                        <div class="col-sm-6">
                            <input type="text" class="form-control" name="remark" value="备注"/>
                        </div>

                    </div>

                    <input type="hidden" id="accountId2" name="accountId">
                    <input type="hidden" id="userId2" name="userId">
                    <input type="hidden" name="txType" value="Expend">


                    <div class="form-group">
                        <div class="col-sm-6">
                            <button type="submit" class="btn btn-info" onclick="submitByClick('myForm2')">提交
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="tab-pane fade" id="zhuanzhang">
            <p>转账</p>
        </div>
    </div>
</div>


<script type="text/javascript">

    console.log("_______1_______");
    /**
     * 提交form 表单, 由按钮触发
     */
    function submitByClick(formName) {

        if (formName == 'myForm1') {
            $('#myForm1').bind('submit', function () {
                console.log("_______2_______");

                ajaxSubmit(this, function (data, status) {
                    //callback 函数
                    console.log("return status:" + status + ", data:" + JSON.stringify(data));

                    $('#message').html(syntaxHighlight(JSON.parse(JSON.stringify(data))));

                });

                return false;
            });
        } else if (formName == 'myForm2') {
            $('#myForm2').bind('submit', function () {
                console.log("_______2_______");

                ajaxSubmit(this, function (data, status) {
                    //callback 函数
                    console.log("return status:" + status + ", data:" + JSON.stringify(data));

                    $('#message').html(syntaxHighlight(JSON.parse(JSON.stringify(data))));

                });

                return false;
            });
        } else {

        }

        var url = window.location.search;
        console.log("url:" + url);

        var redirect = getFormValue(url, 'redirect');
        var userId = getFormValue(url, 'userId');
        var id = getFormValue(url, 'id');

        console.log("redirect to:" + redirect);

        if (redirect == null || redirect == '') {
            redirect = 'home.html';

            window.location.href = redirect + '?userId=' + userId;

        } else {
            //url=?userId=10086&id=4&accountName=%E7%8E%B0%E9%87%91%E9%92%B1%E5%8C%85&redirect=/frontend/fundDebitDetail.html
            window.location.href = redirect + '?userId=' + userId + '&id=' + id;

        }

    }


</script>

</body>
</html>